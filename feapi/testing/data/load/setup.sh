#!/bin/bash


if [ -z "$APP_POSTGRESQL_SOURCE_NAMES" ]; then
    PROFILE_NAME=$APP_POSTGRESQL_PROFILE
    PGPASSWORD=${APP_POSTGRESQL_PASSWORD:-postgres} psql -h ${APP_POSTGRESQL_HOST:-localhost} -U ${APP_POSTGRESQL_USER:-postgres} -f /sql/$PROFILE_NAME/all.sql
else
    SOURCE_NAMES=${APP_POSTGRESQL_SOURCE_NAMES//,/$'\n'}
    for SOURCE_NAME in $SOURCE_NAMES
    do
        PROFILE_VAR_NAME=APP_POSTGRESQL_PROFILE_$SOURCE_NAME
        PASSWORD_VAR_NAME=APP_POSTGRESQL_PASSWORD_$SOURCE_NAME
        HOST_VAR_NAME=APP_POSTGRESQL_HOST_$SOURCE_NAME
        USER_VAR_NAME=APP_POSTGRESQL_USER_$SOURCE_NAME
        PGPASSWORD=${!PASSWORD_VAR_NAME:-postgres} psql -h ${!HOST_VAR_NAME:-localhost} -U ${!USER_VAR_NAME:-postgres} -f /sql/${!PROFILE_VAR_NAME}/all.sql
    done
fi
